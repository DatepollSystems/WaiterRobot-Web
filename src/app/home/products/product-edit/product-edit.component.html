<div [hidden]="isEditing && !entityLoaded">
  <h1 *ngIf="isEditing && entity">{{ 'EDIT_2' | tr }} {{ entity.name }}</h1>
  <h1 *ngIf="!isEditing">{{ 'HOME_PROD_ADD' | tr }}</h1>

  <div fxLayout="row break" fxLayoutGap="3% grid" fxLayoutGap.gt-md="1% grid">
    <div>
      <button class="btn btn-sm btn-dark text-white" (click)="onGoBack()">{{ 'GO_BACK' | tr }}</button>
    </div>

    <ng-container *ngIf="isEditing && entity">
      <div>
        <button class="btn btn-sm btn-success" (click)="f.ngSubmit.emit()" [disabled]="!f.valid">
          <i-bs name="save"></i-bs>
          {{ 'SAVE' | tr }}
        </button>
      </div>
      <div>
        <button class="btn btn-sm btn-outline-danger" (click)="onDelete(entity.id)">
          <i-bs name="trash"></i-bs>
          {{ 'DELETE' | tr }}
        </button>
      </div>
    </ng-container>

    <div *ngIf="!isEditing">
      <button class="btn btn-sm btn-success" (click)="f.ngSubmit.emit()" [disabled]="!f || !f.valid">
        <i-bs name="plus-circle"></i-bs>
        {{ 'ADD' | tr }}
      </button>
    </div>
  </div>

  <form #f="ngForm" (ngSubmit)="onSave(f)">
    <ul ngbNav #nav="ngbNav" [(activeId)]="activeTab" class="nav-tabs mt-3 bg-dark" (navChange)="setTabId($event.nextId)">
      <li [ngbNavItem]="1">
        <a ngbNavLink>{{ 'DATA' | tr }}</a>
        <ng-template ngbNavContent>
          <div fxLayout="row break" fxLayoutAlign="space-between" fxLayout.lt-sm="column">
            <div class="form-group mb-2" fxFlex="40%">
              <label for="name">{{ 'NAME' | tr }}</label>
              <input
                ngbAutofocus
                ngModel
                class="form-control bg-dark text-white"
                required
                type="text"
                id="name"
                name="name"
                #nameModel="ngModel"
                minlength="1"
                maxlength="70"
                placeholder="{{ 'NAME' | tr }}"
                [ngModel]="isEditing ? entity?.name : null" />

              <small *ngIf="nameModel.invalid" class="text-danger">
                {{ 'HOME_PROD_NAME_INCORRECT' | tr }}
              </small>
            </div>

            <div class="form-group mb-2" fxFlex="15%" fxFlex.lt-xl="15%">
              <label for="price">{{ 'HOME_PROD_PRICE' | tr }}</label>
              <input
                ngModel
                class="form-control bg-dark text-white"
                required
                type="number"
                id="price"
                name="price"
                min="0"
                #priceModel="ngModel"
                placeholder="{{ 'HOME_PROD_PRICE' | tr }}"
                [ngModel]="isEditing ? entity?.price : null" />

              <small *ngIf="priceModel.invalid" class="text-danger">
                {{ 'HOME_PROD_PRICE_INCORRECT' | tr }}
              </small>
            </div>

            <ngb-entity-chip-input
              fxFlex="40%"
              [dark]="true"
              [models]="entity?.allergens"
              [allModelsToAutoComplete]="allergens"
              (valueChange)="allergenChange($event)"
              label="HOME_PROD_ALLERGENS"
              placeHolder="HOME_PROD_ALLERGENS_PLACEHOLDER"></ngb-entity-chip-input>
          </div>

          <div fxLayout="row break" fxLayoutGap="2%" fxLayout.lt-sm="column">
            <div class="form-group mb-2" fxFlex="20%" fxFlex.lt-xl="48%">
              <label for="selectGroup">{{ 'HOME_PROD_GROUP' | tr }}</label>
              <div class="input-group">
                <span class="input-group-text bg-dark text-white" id="selectProductGroup-addon"><i-bs name="diagram-3"></i-bs></span>
                <select class="form-select bg-dark text-white" id="selectGroup" name="groupId" [(ngModel)]="selectedProductGroup" required>
                  <option [ngValue]="undefined" disabled>{{ 'HOME_PROD_GROUPS_DEFAULT' | tr }}</option>
                  <option [ngValue]="productGroup.id" *ngFor="let productGroup of this.productGroups; trackById">
                    {{ productGroup.name }}
                  </option>
                </select>
              </div>
            </div>

            <div class="form-group mb-2" fxFlex="20%" fxFlex.lt-xl="48%">
              <label for="selectPrinter">{{ 'NAV_PRINTERS' | tr }}</label>
              <div class="input-group">
                <span class="input-group-text bg-dark text-white" id="selectPrinter-addon"><i-bs name="diagram-3"></i-bs></span>
                <select class="form-select bg-dark text-white" id="selectPrinter" name="printerId" [(ngModel)]="selectedPrinter" required>
                  <option [ngValue]="undefined" disabled>{{ 'HOME_PROD_PRINTER_SELECT_DEFAULT' | tr }}</option>
                  <option [ngValue]="printer.id" *ngFor="let printer of this.printers; trackById">
                    {{ printer.name }}
                  </option>
                </select>
              </div>
            </div>
          </div>

          <div fxLayout="row" fxLayout.lt-sm="column" fxLayoutGap="2%" class="mt-2">
            <div class="form-check">
              <input
                ngModel
                class="form-check-input"
                type="checkbox"
                id="soldOut"
                [ngModel]="isEditing ? entity?.soldOut : null"
                name="soldOut" />
              <label class="form-check-label" for="soldOut">
                {{ 'HOME_PROD_SOLD_OUT' | tr }}
              </label>
            </div>
          </div>

          <div class="form-check form-switch mt-2" *ngIf="!isEditing">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              id="continuousCreation"
              [(ngModel)]="continuousCreation"
              [ngModelOptions]="{standalone: true}" />
            <label class="form-check-label" for="continuousCreation">{{ 'CONTINUOUS_CREATION' | tr }}</label>
          </div>
        </ng-template>
      </li>
    </ul>

    <div [ngbNavOutlet]="nav" class="mt-2 bg-dark"></div>
  </form>
</div>

<div class="spinner-row" *ngIf="isEditing && !entityLoaded">
  <div class="spinner-border" role="status">
    <span class="visually-hidden">{{ 'LOADING' | tr }}</span>
  </div>
</div>

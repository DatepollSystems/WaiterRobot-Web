<ng-container *ngSub="uiControls$; let ui">
  <ng-container *ngIf="vm$ | async as vm">
    <nav class="navbar navbar-expand-md bg-dark navbar-dark">
      <div class="my-container" [class.container-xxxl]="!ui.isFullScreen">
        <a class="navbar-brand align-items-center" routerLink="/home">
          <img id="brand" [ngSrc]="logoUrl" width="30" height="30" class="align-self-center ms-2" alt="kellner.team logo" />

          <ng-container *ngIf="ui.isMobile">
            <div
              *ngIf="showEnvironmentType && environmentType === 'dev'"
              (click)="showEnvironmentType = !showEnvironmentType"
              class="badge bg-warning text-dark ms-3 me-1 not-selectable"
            >
              <span *ngIf="environmentType === 'dev'">DEV</span>
            </div>
            <div style="font-size: 12px" *ngIf="vm.myUser.isAdmin" class="badge bg-danger text-dark ms-3 me-1 not-selectable">
              <span>ADMIN</span>
            </div>
          </ng-container>
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          (click)="toggleNav()"
          data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <div class="d-flex flex-column flex-md-row justify-content-md-between flex-fill" [class.container-xxxl]="ui.isMobile">
            <div>
              <ul class="navbar-nav" [class.mobile-background-0]="ui.isMobile">
                <li class="d-flex align-items-center" *ngIf="!ui.isMobile">
                  <div
                    *ngIf="showEnvironmentType && environmentType === 'dev'"
                    (click)="showEnvironmentType = !showEnvironmentType"
                    class="badge bg-warning text-dark ms-1 me-1 not-selectable"
                  >
                    <span *ngIf="environmentType === 'dev'">DEV</span>
                  </div>
                  <div style="font-size: 12px" *ngIf="vm.myUser.isAdmin" class="badge bg-danger text-dark ms-1 me-1 not-selectable">
                    <span>ADMIN</span>
                  </div>
                </li>

                <li class="nav-item">
                  <div ngbDropdown display="dynamic">
                    <a class="nav-link" id="organisationSwitcherDropdown" ngbDropdownToggle>
                      <span *ngIf="!vm.selectedOrganisation">{{ 'NAV_ORGANISATIONS' | tr }}</span>
                      <span *ngIf="vm.selectedOrganisation"><b>{{ vm.selectedOrganisation.name }}</b></span>
                    </a>
                    <div ngbDropdownMenu aria-labelledby="organisationSwitcherDropdown">
                      <h6 class="dropdown-header">
                        <b>{{ 'NAV_ORGANISATIONS' | tr }}</b>
                      </h6>
                      <a *ngIf="vm.selectedOrganisation" ngbDropdownItem routerLink="organisations/{{ vm.selectedOrganisation.id }}">
                        <b>{{ vm.selectedOrganisation.name }}</b><small> {{ 'NAV_EDIT' | tr }}</small>
                      </a>
                      <span class="fake-dropdown-item unselectable" *ngIf="vm.organisations.length === 0">
                        {{ 'NAV_ORGANISATIONS_NO_ORGS' | tr }}
                      </span>
                      <ng-container *ngFor="let orgM of vm.organisations; trackById">
                        <span
                          class="fake-dropdown-item"
                          *ngIf="orgM.id !== vm.selectedOrganisation?.id"
                          (click)="onSelectOrg(orgM); $event.stopPropagation()"
                        >
                          {{ orgM.name }}
                        </span>
                      </ng-container>
                      <div class="dropdown-divider"></div>
                      <a ngbDropdownItem routerLinkActive="active" routerLink="organisations/create" *ngIf="vm.myUser.isAdmin">
                        <b>+</b> {{ 'ADD_2' | tr }}
                      </a>
                      <a ngbDropdownItem routerLinkActive="active" routerLink="organisations/all">
                        <i-bs name="building" />
                        {{ 'SHOW_ALL' | tr }}
                      </a>
                    </div>
                  </div>
                </li>

                <li class="nav-item">
                  <div ngbDropdown display="dynamic">
                    <a class="nav-link" id="eventSwitcherDropdown" [class.disabled]="!vm.selectedOrganisation" ngbDropdownToggle>
                      <span *ngIf="!vm.selectedEvent">{{ 'NAV_EVENTS' | tr }}</span>
                      <span *ngIf="vm.selectedEvent"><b>{{ vm.selectedEvent.name }}</b></span>
                    </a>
                    <div ngbDropdownMenu aria-labelledby="eventSwitcherDropdown">
                      <h6 class="dropdown-header">
                        <b>{{ 'NAV_EVENTS' | tr }}</b>
                      </h6>
                      <a ngbDropdownItem *ngIf="vm.selectedEvent" routerLink="events/{{ vm.selectedEvent.id }}">
                        <b>{{ vm.selectedEvent.name }}</b><small> {{ 'NAV_EDIT' | tr }}</small>
                      </a>
                      <span class="fake-dropdown-item unselectable" *ngIf="vm.events.length === 0">
                        {{ 'NAV_EVENTS_NO_EVENTS' | tr }}
                      </span>
                      <ng-container *ngFor="let eventM of vm.events; trackById">
                        <span
                          class="fake-dropdown-item"
                          *ngIf="eventM.id !== vm.selectedEvent?.id"
                          (click)="onSelectEvent(eventM); $event.stopPropagation()"
                        >
                          {{ eventM.name }}
                        </span>
                      </ng-container>
                      <div class="dropdown-divider"></div>
                      <a ngbDropdownItem routerLink="events/create" *ngIf="vm.myUser.isAdmin"><b>+</b> {{ 'ADD_2' | tr }}</a>
                      <a ngbDropdownItem routerLink="events/all">
                        <i-bs name="calendar-event-fill" />
                        {{ 'SHOW_ALL' | tr }}
                      </a>
                    </div>
                  </div>
                </li>
              </ul>
            </div>

            <div>
              <ul class="navbar-nav" [class.mobile-background-1]="ui.isMobile">
                <li class="nav-item" *ngIf="vm.myUser.isAdmin">
                  <div ngbDropdown display="dynamic">
                    <a class="nav-link" id="adminDropDown" ngbDropdownToggle> {{ 'NAV_INSTANCE_ADMINISTRATION' | tr }}</a>
                    <div ngbDropdownMenu aria-labelledby="adminDropDown">
                      <a ngbDropdownItem routerLinkActive="active" routerLink="users">
                        <i-bs name="person-badge" />
                        {{ 'NAV_USERS' | tr }}
                      </a>
                      <a ngbDropdownItem routerLinkActive="active" routerLink="system-notifications">
                        <i-bs name="bell" />
                        {{ 'NAV_SYSTEM_NOTIFICATIONS' | tr }}
                      </a>
                    </div>
                  </div>
                </li>

                <li class="nav-item">
                  <div ngbDropdown display="dynamic">
                    <a class="nav-link" id="settingsDropdown" ngbDropdownToggle>{{ 'SETTINGS' | tr }}</a>
                    <div ngbDropdownMenu aria-labelledby="settingsDropdown">
                      <div class="px-3 py-1">
                        <h5>{{ 'NAV_USER_SETTINGS_WELCOME' | tr }} {{ vm.myUser.firstname }},</h5>
                        <a (click)="openUserEmailQRCode(vm.myUser)">
                          <u>{{ vm.myUser.emailAddress }}</u>
                          <i-bs name="qr-code" class="ms-1" />
                        </a>
                        <small>
                          <br />
                          <b *ngIf="vm.myUser.isAdmin" class="clickable" (click)="switchAdminMode()"
                            >{{ 'NAV_USER_SETTINGS_ADMIN' | tr }}</b
                          >
                          <b *ngIf="this.adminModeChanged" class="clickable" (click)="switchAdminMode()"
                            >{{ 'NAV_USER_SETTINGS_ADMIN_SWITCH' | tr }}</b
                          >
                        </small>
                      </div>
                      <div class="dropdown-divider d-none d-xxl-block"></div>
                      <button ngbDropdownItem class="d-none d-xxl-block" (click)="fullScreenService.setFullScreen(!ui.isFullScreen)">
                        <i-bs name="arrows-fullscreen" *ngIf="!ui.isFullScreen" />
                        <i-bs name="fullscreen-exit" *ngIf="ui.isFullScreen" />
                        {{'NAV_FULLSCREEN' | tr}}
                      </button>
                      <div class="dropdown-divider"></div>
                      <a ngbDropdownItem routerLinkActive="active" routerLink="usettings/settings">
                        <i-bs name="gear-wide-connected" />
                        {{ 'NAV_USER_SETTINGS' | tr }}
                      </a>
                      <a ngbDropdownItem routerLinkActive="active" routerLink="usettings/sessions">
                        <i-bs name="file-lock" />
                        {{ 'NAV_USER_SESSIONS' | tr }}
                      </a>
                      <button ngbDropdownItem (click)="logout()">
                        <i-bs name="box-arrow-left" />
                        {{ 'NAV_LOGOUT' | tr }}
                      </button>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <app-navbar-scrollable [isMobile]="ui.isMobile" [items]="navItems" />
  </ng-container>

  <main class="text-white pb-5 bg">
    <div class="my-container" [class.container-xxxl]="!ui.isFullScreen" [class.px-md-2]="ui.isFullScreen">
      <div class="alert alert-warning" role="alert" hideIfOnline>
        <i-bs name="wifi-off" />
        {{ 'OFFLINE' | tr }}
      </div>

      <div hideIfOffline>
        <div hideIfPingSucceeds url="/json">
          <div class="alert alert-warning" role="alert">
            <div class="d-flex gap-3 align-items-center">
              <i-bs name="exclamation-triangle-fill" />
              <div>
                <b>{{ 'ABOUT_MAINTENANCE_1' | tr }}</b>
                <br />
                {{'ABOUT_MAINTENANCE_2' | tr}}
                <br />
                {{'ABOUT_MAINTENANCE_3' | tr}}
                <a style="text-decoration: underline; color: #664d03" href="https://status.kellner.team" target="_blank" rel="noopener"
                  >status.kellner.team</a
                >.
                <br />
                {{'ABOUT_MAINTENANCE_4' | tr}}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="activeSystemNotifications$ | async as activeSystemNotifications">
        <app-system-notification-alert *ngFor="let systemNotification of activeSystemNotifications" [notification]="systemNotification" />
      </div>

      <router-outlet />
    </div>
  </main>
</ng-container>

<app-footer />
